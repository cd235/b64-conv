<!DOCTYPE html>
<html>
<head>
  <title>Download PDF</title>
</head>
<body>
  <h2>Preparing your PDF...</h2>
  <script>
    function getPostData(callback) {
      document.body.innerHTML = '<form id="hiddenForm"><input name="b64"><input name="filename"></form>';
      const form = document.forms[0];
      callback(new FormData(form));
    }

    function downloadPDF(base64, filename = 'report.pdf') {
      const byteCharacters = atob(base64);
      const byteNumbers = new Array(byteCharacters.length);
      for (let i = 0; i < byteCharacters.length; i++) {
        byteNumbers[i] = byteCharacters.charCodeAt(i);
      }
      const byteArray = new Uint8Array(byteNumbers);
      const blob = new Blob([byteArray], { type: 'application/pdf' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.click();
    }

    getPostData(formData => {
      const b64 = formData.get("b64");
      const filename = formData.get("filename") || "report.pdf";

      if (!b64) {
        document.body.innerHTML = "<h2>Error: No data received.</h2>";
        return;
      }

      downloadPDF(b64, filename);
    });
  </script>
</body>
</html>
